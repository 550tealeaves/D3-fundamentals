<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>3D Donut with Inner Layer</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f7f7f7;
      display: flex;
      justify-content: center;
      padding-top: 40px;
    }
    text {
      font-size: 12px;
      fill: #333;
    }
  </style>
</head>
<body>

<script>
// Data
const data = [
  { animal: "Dogs", value: 20 },
  { animal: "Cats", value: 50 },
  { animal: "Birds", value: 10},
  { animal: "Fish", value: 5},
  { animal: "Hedgehog", value: 15}
];

// Dimensions
const width = 600;
const height = 500;
const radius = Math.min(width, height) / 2;

// SVG container
const svg = d3.select("body")
  .append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", `translate(${width/2}, ${height/2})`);

// Color scales
const outerColor = d3.scaleOrdinal()
  .domain(data.map(d => d.animal))
  .range(["#F2755E", "#E65EF2", "#16DE2A", "#3BF7E7", "#F7F73B"]);

const innerColor = d3.scaleOrdinal()
  .domain(data.map(d => d.animal))
  .range(["#fcaea8", "#e4a4f2", "#9ff29a", "#9ff3f0", "#fff76b"]);

// Pie generator
const pie = d3.pie()
  .value(d => d.value)
  .sort(null);

// Outer arc generator (counts)
const outerArc = d3.arc()
  .innerRadius(radius * 0.6)
  .outerRadius(radius * 0.9)
  .cornerRadius(6)
  .padAngle(0.02);

// Inner arc generator (percentages)
const innerArc = d3.arc()
  .innerRadius(radius * 0.3)
  .outerRadius(radius * 0.55)
  .cornerRadius(6)
  .padAngle(0.02);

// Draw outer layer with animation
svg.selectAll(".outer")
  .data(pie(data))
  .join("path")
    .attr("class", "outer")
    .attr("fill", d => outerColor(d.data.animal))
    .attr("stroke", "#fff")
    .attr("stroke-width", 2)
    .transition()
      .duration(3000)
      .attrTween("d", function(d) {
        const i = d3.interpolate(
          { startAngle: d.startAngle, endAngle: d.startAngle },
          d
        );
        return function(t) {
          return outerArc(i(t));
        };
      });

// Draw inner layer with animation
svg.selectAll(".inner")
  .data(pie(data))
  .join("path")
    .attr("class", "inner")
    .attr("fill", d => innerColor(d.data.animal))
    .attr("stroke", "#fff")
    .attr("stroke-width", 1)
    .transition()
      .duration(3000)
      .attrTween("d", function(d) {
        const i = d3.interpolate(
          { startAngle: d.startAngle, endAngle: d.startAngle },
          d
        );
        return function(t) {
          return innerArc(i(t));
        };
      });

// Labels (outside outer arc)
const labelArc = d3.arc()
  .innerRadius(radius * 0.95)
  .outerRadius(radius * 0.95);

svg.selectAll("text")
  .data(pie(data))
  .join("text")
    .attr("transform", d => `translate(${labelArc.centroid(d)})`)
    .text(d => `${d.data.animal}: ${d.data.value}`)
    .style("opacity", 0)
    .transition()
      .delay(1800)
      .style("opacity", 1)
    .style("text-anchor", d => {
      const mid = (d.startAngle + d.endAngle) / 2;
      return mid < Math.PI ? "start" : "end";
    });

</script>

</body>
</html>
