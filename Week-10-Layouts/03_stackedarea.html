<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Stacked Area</title>
        <script src= "https://d3js.org/d3.v7.min.js"></script>
        <style type="text/css">
            
  		/*TBD*/

        </style>
    </head>
    <body>
        <script type="text/javascript">
           
            //MOST CODE SIMILAR TO STACKED BAR CHART

           //CONSTANTS
            const w = 600;
            const h = 600;
            const myColor = d3.scaleOrdinal(d3.schemeTableau10);
            const margin = 50;
            const parseTime = d3.timeParse("%Y-%m"); 

            //DATA
            d3.csv("stacks.csv").then(data => {
                console.log("data", data)
                
                    //FORMAT
                    data.forEach(d => { 
                    d.month = parseTime(d.month);
                    d.rent = +d.rent;
                    d.utilities = +d.utilities;
                    d.food = +d.food;
                    d.other = +d.other;
                    });

            //USING D3.STACK() TO SET UP OR STACK LAYOUT PARAMETERS
            const stack = d3.stack()
                            .keys(["rent", "utilities", "food", "other"])
                            //.order(d3.stackOrderDescending);
                           //.order(d3.stackOrderReverse);
                          
            //STACKING DATA 
            const series = stack(data);
            console.log("stacked data", series);

            //LINE/AREA SCALES -- d3.scaleTime() & d3.scaleLinear
            const xScale = d3.scaleTime()
                             .domain(d3.extent(data, d=>d.month))
                             .range([margin, w-margin]); 

            const yScale = d3.scaleLinear()
                             .domain([0, d3.max(data, d => d.rent + d.utilities + d.food + d.other)])
                             .range([h-margin, margin]); 
            
            //SVG
            const svg = d3.select("body")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);
            

            //NEW: AREA GENERATOR - 2 PARAMETERS - BASELINE/TOPLINE - NEEDS TO KNOW WHERE TO FILL TO
            const area = d3.area()
            			   .x(d=> xScale(d.data.month)) //x-coordinate (see "stacked data" in console) - USE DATA.MONTH TO REFERENCE DATA
            			   .y0(d=>yScale(d[0])) //baseline
            			   .y1(d=>yScale(d[1])); //topine

            //NEW: MAKING AREAS
            //CAN BE HARDER TO SEE SMALL STACKS
            svg.selectAll(".area")
               .data(series)//stacked data
               .enter()
               .append("path")
               .attr("d", area) //path generated by .area()
               .attr("class", "area")
               .style("fill", (d,i)=> myColor(i));      
            
            //BOTTOM AXIS 
            const bottomAxis = d3.axisBottom()
                                .scale(xScale)
                                .tickFormat(d3.timeFormat("%b"));;
             
            svg.append("g")
                .attr("class", "axis") 
                .attr("transform", "translate(0," + (h-margin) + ")") 
                .call(bottomAxis);
            
            //LEFT AXIS
            const leftAxis = d3.axisLeft()
                             .scale(yScale);
                            
            svg.append("g")
               .attr("class", "axis") 
               .attr("transform", "translate(" + margin + ",0)")
               .call(leftAxis);
            });
            /* other relevant charts:
            areas chart and streamgraph*/
        </script>
    </body>
</html>